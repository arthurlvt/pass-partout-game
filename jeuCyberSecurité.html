<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cybers√©curit√© : Le Challenge des Mots de Passe</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
      color: #1f2937;
    }

    .container {
      width: 90%;
      max-width: 900px;
      margin: 24px auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-photo {
      width: 170px;
      height: 170px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
      margin: 0 auto 15px auto;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .profile-box,
    .rules-box,
    .warning-box,
    .lesson-box,
    .game-screen,
    .complete-screen {
      background: white;
      padding: 18px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .warning-box {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fff3cd;
      border-left: 6px solid #facc15;
    }

    .btn {
      display: inline-block;
      padding: 12px 20px;
      background: #2563eb;
      color: white;
      font-size: 1.05em;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn:hover {
      background: #1d4ed8;
    }

    .password-input-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .password-input {
      flex-grow: 1;
      padding: 10px;
      font-size: 1.05em;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
    }

    .toggle-password {
      padding: 10px;
      background: #e5e7eb;
      border: none;
      cursor: pointer;
      border-radius: 6px;
    }

    .feedback {
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      font-weight: bold;
    }

    .feedback.success {
      background: #d1fae5;
      color: #065f46;
    }

    .feedback.error {
      background: #fee2e2;
      color: #991b1b;
    }

    .progress-bar-container {
      width: 100%;
      background: #e5e7eb;
      height: 12px;
      border-radius: 10px;
    }

    .progress-bar {
      height: 12px;
      background: #10b981;
      border-radius: 10px;
      width: 0%;
    }

    .hidden {
      display: none;
    }

    .stat-item {
      padding: 6px 10px;
      border-radius: 6px;
      background: transparent;
      display: inline-block;
    }

    .stat-item.timer.warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
    }

    .stat-item.timer.danger {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
    }

    .found-list li {
      margin-bottom: 6px;
    }

    .skipped-block {
      margin-top: 10px;
      padding: 10px;
      background: #fff7ed;
      border-radius: 8px;
      border-left: 4px solid #f59e0b;
    }

    @media (max-width: 600px) {
      .password-input {
        font-size: 1em;
      }

      .profile-photo {
        width: 130px;
        height: 130px;
      }
    }
  </style>
</head>

<body>
  <!-- INTRO -->
  <div class="container" id="start-screen">
    <div class="header">
      <img class="profile-photo"
        src="https://media.discordapp.net/attachments/1441381261922013224/1441381623919542282/image.png?ex=6930bffe&is=692f6e7e&hm=479ee20f477fb87eec4d4b00c71e0812a43ec8f2e6891c883c366b889099ccad&=&format=webp&quality=lossless&width=1736&height=1736"
        alt="Micheline" />
      <h1>üîíPass-Partout : <i>Le Challenge des Mots de Passe</h1></i> <!-- SWITCH THE TITLE IN ITALIC-->
    </div>
    <div class="profile-box">
      <h2>üë§ Profil de Micheline Delacroix</h2>
      <p><strong>N√©e le :</strong> 1er mars 1950 √† Woippy (Moselle ‚Äì 57140)</p>
      <p><strong>Profession :</strong> Caissi√®re au Lidl de Norroy-le-Veneur</p>
      <p><strong>Enfants :</strong> Nathalie (n√©e le 20/04/1975) et Guillaume (n√© le 17/09/1979)</p>
      <p><strong>Passions :</strong>
        <br>‚Äé ‚Äé - Sa couleur pr√©f√©r√©e est le bleu 
        <br>‚Äé ‚Äé - Elle aime jouer au foot avec son fils
        <br>‚Äé ‚Äé - Elle aime faire de la gym avec sa fille
      </p>
      <p><strong>Animal :</strong> un cobra nomm√© Python</p>
      <p style="margin-top: 10px; font-style: italic"><strong>‚ÑπÔ∏è Fun Fact :</strong> son quintuple
        arri√®re-grand-p√®re serait n√© le 30 f√©vrier 1789.</p>
    </div>
    <div class="rules-box">
      <h2>üéØ R√®gles du jeu</h2>
      <p>‚Ä¢ <strong>Temps total</strong> limit√© √† 8 minutes pour tout chercher</p>
      <p>‚Ä¢ 4 mots de passe par niveau (avec indices si n√©c√©ssaire) dont 
        <br>‚Äé ‚Äé ‚Äé - 2 points √† gagner pour les niveaux 1 et 2
        <br>‚Äé ‚Äé ‚Äé - 1 point pour les niveaux 3, 4 et 5 car niveaux plus durs donc compt√©s comme des niveaux bonus
        <br>‚Äé ‚Äé ‚Äé - Score total sur 7 points (3 bits)
      <p>‚Ä¢ Les √©quipes tentent de deviner les mots de passe √† partir des informations du profil</p>
      <p>‚Ä¢ Les niveaux 4 et 5 introduisent des caract√®res sp√©ciaux et des m√©langes plus complexes</p>
      <p style="margin-top: 10px; font-size: 0.95em">‚úîÔ∏è Vous pouvez activer le chrono au d√©marrage du jeu.</p>
    </div>
    <div class="warning-box">
      <div style="font-size: 1.5em">‚ö†Ô∏è</div>
      <div><strong>Objectif:</strong> Comprendre pourquoi les mots de passe bas√©s sur des informations personnelles sont risqu√©s.</div>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
      <input type="checkbox" id="disable-timer" />
      <label for="disable-timer">Activer le chrono</label>
    </div>
    <button id="start-button" class="btn">üöÄ Commencer le Challenge</button>
  </div>

  <!-- GAME -->
  <div class="container hidden game-screen" id="game-screen">
    <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
      <div>
        <h2 id="level-title">Niveau</h2>
        <p id="password-number">Mot de passe 0 / 0</p>
      </div>
      <div style="display: flex; align-items: center; gap: 12px">
        <div class="stat-item score">üèÜ <strong id="score">0</strong></div>
        <div class="stat-item timer" id="timer-display">‚è±Ô∏è <span id="timer">30</span></div>
      </div>
    </div>
    <div style="margin-top: 14px">
      <p><strong>üîç Entrez un mot de passe :</strong></p>
      <div class="password-input-wrapper">
        <input id="password-input" class="password-input" type="password" placeholder="Entrez un mot de passe..." />
        <button id="toggle-password-btn" class="toggle-password" title="Afficher/masquer">üëÅÔ∏è</button>
      </div>
      <div id="hint" class="hidden" style="margin-top: 10px"></div>
      <div style="margin-top: 12px; display: flex; gap: 8px">
        <button id="validate-btn" class="btn" style="background-color: #047857">‚úì Valider</button>
        <button id="hint-btn" class="btn">üí° Indice</button>
        <button id="skip-btn" class="btn" style="background-color: rgb(106, 2, 2); color: white">‚è≠Ô∏è Skip</button>
      </div>
      <div id="feedback" class="feedback hidden"></div>
    </div>
    <div style="margin-top: 18px; font-size: 0.95em; color: #374151">
      <strong>Mots de passe trouv√©s :</strong>
      <ul id="found-passwords-list" class="found-list" style="margin-top: 8px; list-style-type: none; padding-left: 0">
      </ul>
      <div id="skipped-passwords" class="skipped-block hidden">
        <strong>Mots de passe manqu√©s :</strong>
        <ul id="skipped-list" style="margin-top: 6px; list-style-type: none; padding-left: 0"></ul>
      </div>
    </div>
    <div style="margin-top: 18px; display: flex; gap: 16px; flex-wrap: wrap">
      <div style="flex: 1; min-width: 240px">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span>Progression</span>
          <span id="progress-text">0 / 0</span>
        </div>
        <div class="progress-bar-container">
          <div id="progress-bar" class="progress-bar"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- COMPLETE -->
  <div class="container hidden complete-screen" id="end-screen">
    <div style="text-align: center">
      <div style="font-size: 3rem">üèÜ</div>
      <h1>Challenge Termin√© !</h1>
    </div>
    <div style="margin-top: 12px; text-align: center">
      <div style="font-size: 2rem; font-weight: bold" id="final-score">0</div>
      <p style="color: #6b7280" id="max-score-text">points sur ...</p>
      <p id="percentage" style="margin-top: 6px"></p>
      <p id="hints-used"></p>
    </div>
    <div style="text-align: center; margin-top: 12px">
      <button id="replay-btn" class="btn">üîÑ Rejouer</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <script>
    (function () {
      const levels = [
        {
          level: 1,
          name: "Niveau 1 : 4 chiffres",
          time: 30,
          bonusMode: false, // Progressif
          totalPoints: 2,
          passwords: [
            { password: "1950", hint: "Son ann√©e de naissance" },
            { password: "1975", hint: "Ann√©e de naissance de Nathalie" },
            { password: "0319", hint: "Mois + deux derniers chiffres de l'ann√©e" },
            { password: "2004", hint: "Jour et mois de naissance de Nathalie" },
          ]
        },
        {
          level: 2,
          name: "Niveau 2 : 4 lettres + 2 chiffres",
          time: 40,
          bonusMode: false, // Progressif
          totalPoints: 2,
          passwords: [
            { password: "bleu03", hint: "Sa couleur pr√©f√©r√©e + jour de naissance" },
            { password: "lidl01", hint: "Lieu de travail + jour de naissance" },
            { password: "mich50", hint: "Son pr√©nom + deux chiffres de naissance" },
            { password: "pyth03", hint: "Son animal pr√©f√©r√© + mois de naissance" },
          ]
        },
        {
          level: 3,
          name: "Niveau 3 : 6 caract√®res (lettres + chiffres)",
          time: 45,
          bonusMode: true, // Tout ou rien
          totalPoints: 1,
          passwords: [
            { password: "cobra3", hint: "Son animal + nombre qu'elle poss√®de" },
            { password: "foot57", hint: "Son sport pr√©f√©r√© + d√©partement" },
            { password: "vente50", hint: "Son m√©tier d'avant + ann√©e" },
            { password: "retro79", hint: "Passion de Guillaume + ann√©e" },
          ]
        },
        {
          level: 4,
          name: "Niveau 4 : 6 caract√®res + symboles",
          time: 50,
          bonusMode: true, // Tout ou rien
          totalPoints: 1,
          passwords: [
            { password: "gym@75", hint: "Sport de Nathalie + @ + ann√©e de naissance" },
            { password: "art79!", hint: "Passion de Guillaume + ann√©e + !" },
            { password: "lid@50", hint: "Travail + symbole + ann√©e" },
            { password: "py@03!", hint: "Animal + @ + mois + !" },
          ]
        },
        {
          level: 5,
          name: "Niveau 5 : 8 caract√®res",
          time: 60,
          bonusMode: true, // Tout ou rien
          totalPoints: 1,
          passwords: [
            { password: "ch@te@u1", hint: "Lieu d'h√©ritage avec des @ et chiffres" },
            { password: "lidl7579", hint: "Travail + ann√©es de naissance des enfants" },
            { password: "pyth@1950", hint: "Animal + symbole + ann√©e" },
            { password: "neuilly92", hint: "Ville + code d√©partement" },
          ]
        }
      ];

      let remaining = [], totalScore = 0, hintsUsed = 0, elapsedTime = 0, timerInterval = null;
      let showHintFlag = false, skippedPasswords = [], levelProgress = {};

      const $ = id => document.getElementById(id);

      const startScreen = $("start-screen"),
        gameScreen = $("game-screen"),
        endScreen = $("end-screen"),
        startBtn = $("start-button"),
        validateBtn = $("validate-btn"),
        hintBtn = $("hint-btn"),
        skipBtn = $("skip-btn"),
        togglePwdBtn = $("toggle-password-btn"),
        passwordInput = $("password-input"),
        timerSpan = $("timer"),
        timerDisplay = $("timer-display"),
        scoreEl = $("score"),
        feedbackEl = $("feedback"),
        hintEl = $("hint"),
        progressText = $("progress-text"),
        progressBar = $("progress-bar"),
        foundList = $("found-passwords-list"),
        levelTitle = $("level-title"),
        finalScoreEl = $("final-score"),
        maxScoreText = $("max-score-text"),
        percentageEl = $("percentage"),
        hintsUsedEl = $("hints-used"),
        replayBtn = $("replay-btn"),
        enableTimerCheckbox = $("disable-timer"),
        skippedDiv = $("skipped-passwords"),
        skippedList = $("skipped-list");

      function buildRemaining() {
        remaining = [];
        levelProgress = {};
        levels.forEach(l => {
          levelProgress[l.level] = { found: 0, total: l.passwords.length };
          l.passwords.forEach(p => remaining.push({
            level: l.level,
            name: l.name,
            password: p.password,
            hint: p.hint,
            bonusMode: l.bonusMode,
            totalPoints: l.totalPoints,
            passwordCount: l.passwords.length
          }));
        });
      }

      function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      function calculateScore() {
        let score = 0;
        levels.forEach(l => {
          const found = levelProgress[l.level].found;
          const total = levelProgress[l.level].total;

          if (l.bonusMode) {
            // Tout ou rien
            if (found === total) {
              score += l.totalPoints;
            }
          } else {
            // Progressif
            score += (found / total) * l.totalPoints;
          }
        });
        return score;
      }

      function startGame() {
        buildRemaining();
        totalScore = 0; hintsUsed = 0; showHintFlag = false; skippedPasswords = []; elapsedTime = 0;
        startScreen.classList.add("hidden");
        endScreen.classList.add("hidden");
        gameScreen.classList.remove("hidden");
        foundList.innerHTML = "";
        skippedList.innerHTML = "";
        skippedDiv.classList.add("hidden");

        // Chronom√®tre
        clearInterval(timerInterval); timerInterval = null;
        if (enableTimerCheckbox.checked) {
          timerSpan.textContent = formatTime(0);
          timerDisplay.classList.remove("warning", "danger");
          timerInterval = setInterval(() => {
            elapsedTime++;
            timerSpan.textContent = formatTime(elapsedTime);
          }, 1000);
        } else {
          timerSpan.textContent = "‚Äî";
          timerDisplay.classList.remove("warning", "danger");
        }

        loadNextTarget();
      }

      function loadNextTarget() {
        if (remaining.length === 0) return endGame();
        const target = remaining[0];
        levelTitle.textContent = target.name;

        // Afficher le mode de points
        const levelConfig = levels.find(l => l.level === target.level);
        const modeText = levelConfig.bonusMode ? " üéÅ BONUS (tout ou rien)" : " üìä Progressif";
        $("password-number").textContent = `Mot de passe (${levelProgress[target.level].found}/${levelProgress[target.level].total}) ${modeText}`;

        passwordInput.value = "";
        hintEl.classList.add("hidden"); hintEl.textContent = "";
        showHintFlag = false; hintBtn.disabled = false;
        feedbackEl.classList.add("hidden"); feedbackEl.textContent = "";
        updateProgress();
      }

      function checkPassword() {
        const input = passwordInput.value.trim(); if (!input) return;
        const idx = remaining.findIndex(r => r.password === input);
        if (idx === -1) { showFeedback("Mot de passe incorrect, r√©essayez !", false); return; }

        const found = remaining[idx];
        levelProgress[found.level].found++;

        totalScore = calculateScore();
        scoreEl.textContent = totalScore.toFixed(2);

        showFeedback(`Correct ! Score recalcul√©.`, true);
        const li = document.createElement("li");
        li.textContent = `${found.name} ‚Äî ${found.password}`;
        foundList.appendChild(li);

        remaining.splice(idx, 1);
        setTimeout(loadNextTarget, 600);
      }

      function showFeedback(msg, ok) {
        feedbackEl.textContent = (ok ? "‚úì " : "‚úó ") + msg;
        feedbackEl.className = "feedback " + (ok ? "success" : "error");
        feedbackEl.classList.remove("hidden");
      }

      function useHint() {
        if (showHintFlag || remaining.length === 0) return;
        showHintFlag = true;
        const target = remaining[0];
        hintEl.textContent = "üí° " + target.hint;
        hintEl.classList.remove("hidden");
        totalScore = Math.max(0, +(totalScore - 0.05).toFixed(2));
        scoreEl.textContent = totalScore.toFixed(2);
        hintsUsed++;
        hintBtn.disabled = true;
      }

      function skipTarget() {
        if (remaining.length === 0) return;
        const currentLevel = remaining[0].level;
        const toSkip = remaining.filter(r => r.level === currentLevel);
        skippedPasswords.push(...toSkip);
        remaining = remaining.filter(r => r.level !== currentLevel);
        showFeedback("Niveau saut√©.", false);
        updateSkippedDisplay();
        setTimeout(loadNextTarget, 400);
      }

      function updateSkippedDisplay() {
        if (skippedPasswords.length === 0) {
          skippedDiv.classList.add("hidden");
          skippedList.innerHTML = "";
          return;
        }
        skippedDiv.classList.remove("hidden");
        skippedList.innerHTML = "";
        skippedPasswords.forEach(p => {
          const li = document.createElement("li");
          li.textContent = `${p.name} ‚Äî ${p.password}`;
          skippedList.appendChild(li);
        });
      }

      function updateProgress() {
        const total = levels.reduce((s, l) => s + l.passwords.length, 0);
        const done = total - remaining.length;
        progressText.textContent = `${done} / ${total}`;
        progressBar.style.width = (done / total) * 100 + "%";
      }

      function endGame() {
        clearInterval(timerInterval); timerInterval = null;
        gameScreen.classList.add("hidden");
        endScreen.classList.remove("hidden");

        totalScore = calculateScore(); // Recalcul final
        finalScoreEl.textContent = totalScore.toFixed(2);

        const results = {
          score: totalScore,
          skipped: skippedPasswords,
          hintsUsed: hintsUsed,
          time: elapsedTime,
          date: new Date().toISOString()
        };
        localStorage.setItem("gameResults", JSON.stringify(results));
        launchConfetti();

        maxScoreText.textContent = `points sur 7 possibles`;
        percentageEl.textContent = Math.round((totalScore / 7) * 100) + "%";
        hintsUsedEl.textContent = hintsUsed > 0 ? `üí° Indices utilis√©s : ${hintsUsed}` : "";

        if (enableTimerCheckbox.checked) {
          const timeDiv = document.createElement("p");
          timeDiv.textContent = `‚è±Ô∏è Temps √©coul√© : ${formatTime(elapsedTime)}`;
          timeDiv.style.marginTop = "10px";
          timeDiv.style.color = "#6b7280";
          endScreen.insertBefore(timeDiv, replayBtn.parentElement);
        }

        // D√©tail des scores par niveau
        const detailDiv = document.createElement("div");
        detailDiv.style.marginTop = "15px";
        detailDiv.style.textAlign = "left";
        detailDiv.style.background = "#f3f4f6";
        detailDiv.style.padding = "15px";
        detailDiv.style.borderRadius = "8px";
        let detailText = "üìä D√©tail par niveau :\n\n";
        levels.forEach(l => {
          const found = levelProgress[l.level].found;
          const total = levelProgress[l.level].total;
          let earnedPoints = 0;
          if (l.bonusMode) {
            earnedPoints = found === total ? l.totalPoints : 0;
            detailText += `${l.name} : ${found}/${total} mots ‚Üí ${earnedPoints}/${l.totalPoints} pts ${found === total ? 'üéÅ' : '‚ùå'}\n`;
          } else {
            earnedPoints = (found / total) * l.totalPoints;
            detailText += `${l.name} : ${found}/${total} mots ‚Üí ${earnedPoints.toFixed(2)}/${l.totalPoints} pts üìä\n`;
          }
        });
        detailDiv.style.whiteSpace = "pre-line";
        detailDiv.textContent = detailText;
        endScreen.insertBefore(detailDiv, replayBtn.parentElement);

        if (skippedPasswords.length > 0) {
          const div = document.createElement("div");
          div.style.whiteSpace = "pre-line";
          div.style.marginTop = "15px";
          div.style.textAlign = "left";
          div.style.background = "#fff7ed";
          div.style.padding = "15px";
          div.style.borderRadius = "8px";
          div.style.borderLeft = "4px solid #f59e0b";
          let text = "Mots de passe manqu√©s :\n";
          skippedPasswords.forEach(p => { text += `- ${p.name} : ${p.password}\n`; });
          div.textContent = text;
          endScreen.insertBefore(div, replayBtn.parentElement);
        }
      }

      function launchConfetti() {
        const duration = 3000, end = Date.now() + duration;
        (function frame() {
          confetti({ particleCount: 4, spread: 60 });
          if (Date.now() < end) requestAnimationFrame(frame);
        })();
      }

      function togglePasswordVisibility() {
        passwordInput.type = passwordInput.type === "password" ? "text" : "password";
      }

      function replay() {
        const extras = endScreen.querySelectorAll("div[style], p[style]");
        extras.forEach(el => el.remove());
        endScreen.classList.add("hidden");
        startScreen.classList.remove("hidden");
      }

      startBtn.addEventListener("click", startGame);
      validateBtn.addEventListener("click", checkPassword);
      hintBtn.addEventListener("click", useHint);
      skipBtn.addEventListener("click", skipTarget);
      togglePwdBtn.addEventListener("click", togglePasswordVisibility);
      replayBtn.addEventListener("click", replay);
      passwordInput.addEventListener("keydown", e => { if (e.key === "Enter") checkPassword(); });
    })();
  </script>
</body>

</html>